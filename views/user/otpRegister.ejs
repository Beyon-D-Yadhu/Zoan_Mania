<%- include('h1'); -%>

<section>
    <div class="main">
        <h4 class="mt-5">Verification</h4>
        <p>Enter your 4-digit code that you received on your email.</p>
        <div class="otp-section">
            <form id="otpForm">
                <!-- if(erro !== "" && erro){ %>
                    <p class="alert alert-danger" id="disapear"erro%></p>
                < } else { %>
                    <p class="alert alert-danger" style="display: none;"><erro%></p>
                < } %> -->
                <span id="alert" class="alert alert-primary" role="alert" style="display: none;"> 
                    <strong id="tex"></strong> 
                </span>
                

                <div class="otps">
                    <input type="number" name="number1" id="number1" style="text-align: center;" class="numb">
                    <!-- You can add similar input fields for number2, number3, and number4 if needed -->
                </div>
                <div class="timer mt-1" style="text-align: center;">00:60</div> 
                <div class="button d-flex justify-content-center mt-3">
                    <button type="button" id="verifyButton" class="row p-1">Verify</button>
                </div>
            </form>

            <div class="resend-otp" style="display: none; text-align: center;">
                <!-- <a href="/resendOtp" style="text-decoration: none; display: inline-block; vertical-align: middle;"> -->
                    <div style="text-decoration: none; display: inline-block; vertical-align: middle;">
                        <button id="resendButton" class="row" onclick="resendOTP()" style="vertical-align: middle;">Resend OTP</button>
                    </div>
                <!-- </a> -->
            </div>
        </div>
    </div>
</section>

<script>
let timeInSeconds = localStorage.getItem('otpTimer') || 60;

function updateTimer() {
    const timerElement = document.querySelector('.timer');
    timerElement.textContent = `00:${timeInSeconds.toString().padStart(2, '0')}`;
    timeInSeconds--;

    if (timeInSeconds < 0) {
        clearInterval(timerInterval);
        displayResendButton();
    }
}

function displayResendButton() {
    const resendButton = document.querySelector('.resend-otp');
    resendButton.style.display = 'block';
}

function resendOTP() {
    timeInSeconds = 60;
    document.querySelector('.timer').textContent = '00:60';
    document.querySelector('.resend-otp').style.display = 'none';
    timerInterval = setInterval(updateTimer, 1000);
    localStorage.setItem('otpTimer', timeInSeconds);
    fetch('/resendOtp')
    .then(res=>res.json())
    .then((data)=>{
        
    })
}

 let timerInterval = setInterval(updateTimer, 1000);

// Clear localStorage when the page is loaded initially
window.onload = function () {
    localStorage.removeItem('otpTimer');
};

// Clear localStorage when the page is closed or refreshed
window.onbeforeunload = function () {
    localStorage.removeItem('otpTimer');
};

document.getElementById('verifyButton').addEventListener('click', function() {
    console.log("clicked")
    const userOtp = document.getElementById('number1').value;

    fetch('/home', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ number1: userOtp }),
    })
    .then(response => response.json())
    .then(data => {
        // Handle the response data as needed
        // console.log(data);
        if(data.success){
            window.location.replace('/userHome')
        }
        if (!(data.success)){
            $('#alert').show()
            $('#tex').text(data.message)
            setTimeout(()=>{
                $('#tex').text('')
                $('#alert').hide()
            },3000)
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
});

</script>




<%- include('f1'); -%>
